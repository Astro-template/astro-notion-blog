document.addEventListener("DOMContentLoaded",async()=>{let l=[],c=!1;async function m(){document.querySelector(".search-modal-container").style.display="block",document.querySelector(".search-prompt input").focus(),c||await S(),i()}function a(){document.querySelector(".search-modal-container").style.display="none"}function f(e){e.keyCode===13?h():e.keyCode===27?a():e.keyCode===38?y(e):e.keyCode===40?E(e):i()}function h(){document.querySelector(".search-result ul > li.selected a").click()}function p(){const e=document.querySelector(".search-result ul > li:first-child");e&&e.classList.add("selected")}function y(e){e.preventDefault();const s=document.querySelector(".search-result ul"),t=s.querySelector(".selected");t?(t.classList.remove("selected"),t.previousElementSibling?t.previousElementSibling.classList.add("selected"):s.lastElementChild.classList.add("selected")):s.lastElementChild.classList.add("selected")}function E(e){e.preventDefault();const s=document.querySelector(".search-result ul"),t=s.querySelector(".selected");t?(t.classList.remove("selected"),t.nextElementSibling?t.nextElementSibling.classList.add("selected"):s.firstElementChild.classList.add("selected")):s.firstElementChild.classList.add("selected")}function L(e){Array.from(e.target.closest("ul").children).forEach(s=>{s.classList.remove("selected")}),e.target.closest("li").classList.add("selected")}function i(){const e=document.querySelector(".search-prompt input").value.trim();if(e!==""){const s=C(e);u(s)}else u(l);p()}function C(e){const s=[];return l.forEach(t=>{(t.title.includes(e)||t?.description?.includes(e))&&s.push(t)}),s}function u(e){const s=document.querySelector(".search-result ul");s.innerHTML="",e.forEach(t=>{const o=document.createElement("li"),r=document.createElement("a"),d=document.createElement("div"),n=document.createElement("div");d.classList.add("search-result-title"),d.textContent=t.title,n.classList.add("search-result-description"),n.textContent=t.description,r.href=t.link,o.addEventListener("mouseover",L),r.appendChild(d),r.appendChild(n),o.appendChild(r),s.appendChild(o)})}async function S(){const e=new URL(location.href),s=e.port?`:${e.port}`:"",t=await fetch(`${e.protocol}//${e.hostname}${s}/feed`);if(t.status!==200)throw console.log(t.status),new Error("Failed to fetch RSS feed");const o=await t.text(),d=new DOMParser().parseFromString(o,"text/xml");Array.from(d.getElementsByTagName("item")).forEach(n=>{const g=n.getElementsByTagName("title")[0].textContent,k=n.getElementsByTagName("link")[0].textContent,v=n.getElementsByTagName("description")[0]?.textContent,x=n.getElementsByTagName("pubDate")[0].textContent;l.push({title:g,link:k,description:v,pubDate:x})}),c=!0}Array.from(document.getElementsByClassName("open-search-modal")).forEach(e=>{e.addEventListener("click",m)}),document.getElementsByClassName("overlay")[0].addEventListener("click",a),document.addEventListener("keydown",f)});document.addEventListener("DOMContentLoaded",()=>{function l(c){c.keyCode===75&&c.metaKey&&document.querySelector(".open-search-modal").click()}document.addEventListener("keydown",l)});
